<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>x-speedSheet 源码解读 | 云旭泉的博客</title>
    <meta name="generator" content="VuePress 1.5.1">
    
    <meta name="description" content="专注全栈技术分享">
    <link rel="preload" href="/blog/assets/css/0.styles.39c0576a.css" as="style"><link rel="preload" href="/blog/assets/js/app.9b8d30b8.js" as="script"><link rel="preload" href="/blog/assets/js/2.0a93f5dd.js" as="script"><link rel="preload" href="/blog/assets/js/37.eaaf3327.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.f798a2d8.js"><link rel="prefetch" href="/blog/assets/js/11.d54a8208.js"><link rel="prefetch" href="/blog/assets/js/12.e0a98157.js"><link rel="prefetch" href="/blog/assets/js/13.87c877fd.js"><link rel="prefetch" href="/blog/assets/js/14.d7c59895.js"><link rel="prefetch" href="/blog/assets/js/15.6277aecb.js"><link rel="prefetch" href="/blog/assets/js/16.01e8b1ad.js"><link rel="prefetch" href="/blog/assets/js/17.712b9225.js"><link rel="prefetch" href="/blog/assets/js/18.522ef26f.js"><link rel="prefetch" href="/blog/assets/js/19.5445ecf3.js"><link rel="prefetch" href="/blog/assets/js/20.47f43b7b.js"><link rel="prefetch" href="/blog/assets/js/21.9f8c275f.js"><link rel="prefetch" href="/blog/assets/js/22.a756c658.js"><link rel="prefetch" href="/blog/assets/js/23.b4bcee6c.js"><link rel="prefetch" href="/blog/assets/js/24.8ec49f71.js"><link rel="prefetch" href="/blog/assets/js/25.775adcca.js"><link rel="prefetch" href="/blog/assets/js/26.ee451341.js"><link rel="prefetch" href="/blog/assets/js/27.d3f4e021.js"><link rel="prefetch" href="/blog/assets/js/28.b9c8da82.js"><link rel="prefetch" href="/blog/assets/js/29.d8e3f233.js"><link rel="prefetch" href="/blog/assets/js/3.ffb23f29.js"><link rel="prefetch" href="/blog/assets/js/30.931a269f.js"><link rel="prefetch" href="/blog/assets/js/31.0125aec6.js"><link rel="prefetch" href="/blog/assets/js/32.bf0f1052.js"><link rel="prefetch" href="/blog/assets/js/33.1b679a21.js"><link rel="prefetch" href="/blog/assets/js/34.b5543fb7.js"><link rel="prefetch" href="/blog/assets/js/35.0bfad671.js"><link rel="prefetch" href="/blog/assets/js/36.de9fee6a.js"><link rel="prefetch" href="/blog/assets/js/38.1e0f9389.js"><link rel="prefetch" href="/blog/assets/js/39.5ec5bcd4.js"><link rel="prefetch" href="/blog/assets/js/4.a0155084.js"><link rel="prefetch" href="/blog/assets/js/40.a851c68a.js"><link rel="prefetch" href="/blog/assets/js/41.ce3ebcca.js"><link rel="prefetch" href="/blog/assets/js/42.d7a988ab.js"><link rel="prefetch" href="/blog/assets/js/43.34c1ed44.js"><link rel="prefetch" href="/blog/assets/js/44.8f6680b9.js"><link rel="prefetch" href="/blog/assets/js/45.0fbc2ae1.js"><link rel="prefetch" href="/blog/assets/js/46.fd04d742.js"><link rel="prefetch" href="/blog/assets/js/47.1ec9c3da.js"><link rel="prefetch" href="/blog/assets/js/48.081d87ac.js"><link rel="prefetch" href="/blog/assets/js/49.eb09b8f9.js"><link rel="prefetch" href="/blog/assets/js/5.e569c75c.js"><link rel="prefetch" href="/blog/assets/js/50.7d1733bd.js"><link rel="prefetch" href="/blog/assets/js/51.0c621372.js"><link rel="prefetch" href="/blog/assets/js/52.63757a91.js"><link rel="prefetch" href="/blog/assets/js/53.6d33b67a.js"><link rel="prefetch" href="/blog/assets/js/54.d6014ffc.js"><link rel="prefetch" href="/blog/assets/js/6.eb41542c.js"><link rel="prefetch" href="/blog/assets/js/7.f36d4014.js"><link rel="prefetch" href="/blog/assets/js/8.5980153c.js"><link rel="prefetch" href="/blog/assets/js/9.cadab512.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.39c0576a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">云旭泉的博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/blog/node/" class="nav-link">
  node
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/web/react/" class="nav-link">
  react
</a></li><li class="dropdown-item"><!----> <a href="/blog/web/js/" class="nav-link router-link-active">
  js
</a></li></ul></div></div><div class="nav-item"><a href="/blog/rearend/" class="nav-link">
  后端
</a></div><div class="nav-item"><a href="/blog/interview/" class="nav-link">
  面试问题
</a></div><div class="nav-item"><a href="/blog/other/" class="nav-link">
  其它
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/blog/node/" class="nav-link">
  node
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/web/react/" class="nav-link">
  react
</a></li><li class="dropdown-item"><!----> <a href="/blog/web/js/" class="nav-link router-link-active">
  js
</a></li></ul></div></div><div class="nav-item"><a href="/blog/rearend/" class="nav-link">
  后端
</a></div><div class="nav-item"><a href="/blog/interview/" class="nav-link">
  面试问题
</a></div><div class="nav-item"><a href="/blog/other/" class="nav-link">
  其它
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>js</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/web/js/x-speedsheet源码解读.html" class="active sidebar-link">x-speedSheet 源码解读</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/web/js/x-speedsheet源码解读.html#整体架构" class="sidebar-link">整体架构</a></li><li class="sidebar-sub-header"><a href="/blog/web/js/x-speedsheet源码解读.html#渲染" class="sidebar-link">渲染</a></li><li class="sidebar-sub-header"><a href="/blog/web/js/x-speedsheet源码解读.html#事件系统" class="sidebar-link">事件系统</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>react</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="x-speedsheet-源码解读"><a href="#x-speedsheet-源码解读" class="header-anchor">#</a> x-speedSheet 源码解读</h1> <h2 id="整体架构"><a href="#整体架构" class="header-anchor">#</a> 整体架构</h2> <h2 id="渲染"><a href="#渲染" class="header-anchor">#</a> 渲染</h2> <h3 id="初始渲染"><a href="#初始渲染" class="header-anchor">#</a> 初始渲染</h3> <h4 id="_1-调用speadsheet构造函数"><a href="#_1-调用speadsheet构造函数" class="header-anchor">#</a> 1 调用SpeadSheet构造函数</h4> <p>1.1	主要是根据传入的options创建出dom元素插入到传入的id元素中，有点类似react把虚拟dom元素创建出来之后，插入到页面设置的id元素上。</p> <p>1.2	初始化一些数据，比如this.data 就是表示代理了整个sheet 数据的，有点类似设置了整个sheet数据的proxy。</p> <p>1.3	this.sheet 表示整个sheet的初始化和事件的初始化，同时把this.data 也挂载到this.sheet.data上面，同时把event和table等数据表示挂载到上面。比如下图就是this.sheet的数据结构。</p> <p>![image-20210710114201688](/Users/zsj/Library/Application Support/typora-user-images/image-20210710114201688.png)</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">selectors<span class="token punctuation">,</span> options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> targetEl <span class="token operator">=</span> selectors<span class="token punctuation">;</span>

    <span class="token comment">// 默认显示bottombar</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>options <span class="token operator">=</span> <span class="token punctuation">{</span> showBottomBar<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token operator">...</span>options <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// sheetIndex 类似excel下面的几个表格的索引</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>sheetIndex <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token comment">// 所有的数据，也就是每个sheet在数组中一个索引</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>datas <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> selectors <span class="token operator">===</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 获取容器</span>
      targetEl <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span>selectors<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>bottombar <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>showBottomBar
      <span class="token operator">?</span> <span class="token keyword">new</span> <span class="token class-name">Bottombar</span><span class="token punctuation">(</span>
          <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> d <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>sheet<span class="token punctuation">.</span><span class="token function">resetData</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">(</span><span class="token parameter">index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> d <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>datas<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>sheet<span class="token punctuation">.</span><span class="token function">resetData</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">deleteSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">(</span><span class="token parameter">index<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>datas<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>name <span class="token operator">=</span> value<span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">)</span>
      <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token comment">// #</span>
    <span class="token comment">// addSheet(name, active)</span>
    <span class="token comment">// 功能 添加多表</span>
    <span class="token comment">// @param name string 名称</span>
    <span class="token comment">// @param active boolean 默认为 true</span>
    <span class="token comment">// this.data 表示一张表的所有数据代理</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>data <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// h就是创建一个对象，该对象的属性el表示创建的dom元素</span>
    <span class="token keyword">const</span> rootEl <span class="token operator">=</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>cssPrefix<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;contextmenu&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">evt</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
      evt<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 把我们创建的元素插入到浏览器的dom元素上</span>
    targetEl<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>rootEl<span class="token punctuation">.</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 创建表，this.data表示 DataProxy 代理类</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>sheet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Sheet</span><span class="token punctuation">(</span>rootEl<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>bottombar <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      rootEl<span class="token punctuation">.</span><span class="token function">child</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>bottombar<span class="token punctuation">.</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre></div><h4 id="_2-sheet类"><a href="#_2-sheet类" class="header-anchor">#</a> 2 Sheet类</h4> <p>通过在构造函数中的逻辑可以发现，几乎所有的初始化整个views层和初始化事件等逻辑都在Sheet类中</p> <p>在源码中this.sheet = new Sheet(rootEl, this.data); rootEl是一个div的数据结构，想象成是类似react的viralDOM表示就可以了，不过会比viralDOM简单很多。this.data就是在构造函数里边创建的整个sheet中的data的proxy代理对象。</p> <p>在Sheet的构造函数中也是做了一些初始化的工作，比如创建toolbar对象，print 打印的对象，创建select的时候div的对象，创建edit的时候div的对象等，等到创建完这些对象之后，然后调用事件初始化函数初始化事件，调用render函数渲染。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">targetEl<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 使用发布订阅模式</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>eventMap <span class="token operator">=</span> <span class="token function">createEventEmitter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> view<span class="token punctuation">,</span> showToolbar<span class="token punctuation">,</span> showContextmenu <span class="token punctuation">}</span> <span class="token operator">=</span> data<span class="token punctuation">.</span>settings<span class="token punctuation">;</span>

    <span class="token comment">// el 表示真实的dom元素</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>el <span class="token operator">=</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>cssPrefix<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-sheet</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 创建toolbar</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>toolbar <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Toolbar</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> view<span class="token punctuation">.</span>width<span class="token punctuation">,</span> <span class="token operator">!</span>showToolbar<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 创建打印</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>print <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    targetEl<span class="token punctuation">.</span><span class="token function">children</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>toolbar<span class="token punctuation">.</span>el<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>el<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>print<span class="token punctuation">.</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// sheetDataProxy 代理</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>data <span class="token operator">=</span> data<span class="token punctuation">;</span>
    <span class="token comment">// 创建表格</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>tableEl <span class="token operator">=</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">&quot;canvas&quot;</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>cssPrefix<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-table</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 创建缩放</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>rowResizer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Resizer</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> data<span class="token punctuation">.</span>rows<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>colResizer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Resizer</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">,</span> data<span class="token punctuation">.</span>cols<span class="token punctuation">.</span>minWidth<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 创建scrollbar</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>verticalScrollbar <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scrollbar</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>horizontalScrollbar <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scrollbar</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 创建editor div对象</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>editor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Editor</span><span class="token punctuation">(</span>
      formulas<span class="token punctuation">,</span>
      <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getTableOffset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      data<span class="token punctuation">.</span>rows<span class="token punctuation">.</span>height
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 创建data检测</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>modalValidation <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ModalValidation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 创建右键点击的菜单栏</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>contextMenu <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ContextMenu</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">!</span>showContextmenu<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 创建selected，也就是在表格中点击之后的对象</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>selector <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Selector</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 创建遮罩层，通过这里获取到事件</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>overlayerCEl <span class="token operator">=</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>cssPrefix<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-overlayer-content</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">children</span><span class="token punctuation">(</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>editor<span class="token punctuation">.</span>el<span class="token punctuation">,</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>selector<span class="token punctuation">.</span>el
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>overlayerEl <span class="token operator">=</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>cssPrefix<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-overlayer</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">child</span><span class="token punctuation">(</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>overlayerCEl
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 创建排序</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>sortFilter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SortFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 把创建的dom元素都插入到this.el中</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>el<span class="token punctuation">.</span><span class="token function">children</span><span class="token punctuation">(</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>tableEl<span class="token punctuation">,</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>overlayerEl<span class="token punctuation">.</span>el<span class="token punctuation">,</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>rowResizer<span class="token punctuation">.</span>el<span class="token punctuation">,</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>colResizer<span class="token punctuation">.</span>el<span class="token punctuation">,</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>verticalScrollbar<span class="token punctuation">.</span>el<span class="token punctuation">,</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>horizontalScrollbar<span class="token punctuation">.</span>el<span class="token punctuation">,</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>contextMenu<span class="token punctuation">.</span>el<span class="token punctuation">,</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>modalValidation<span class="token punctuation">.</span>el<span class="token punctuation">,</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>sortFilter<span class="token punctuation">.</span>el
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 创建table对象</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>table <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Table</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>tableEl<span class="token punctuation">.</span>el<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 初始化事件</span>
    <span class="token function">sheetInitEvents</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 调用表格的render画出表格</span>
    <span class="token function">sheetReset</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 设置选择的表格的cell的坐标为0，0</span>
    <span class="token function">selectorSet</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre></div><h4 id="_3-table"><a href="#_3-table" class="header-anchor">#</a> 3 Table</h4> <p>Table的构造函数没有做过多的东西，很简单就是初始化了一些变量，this.draw就是一个画的函数，一个this.data是前面的sheetDataProxy。</p> <p>这里的主要逻辑在Table的render函数里边</p> <p>render函数里边就是一些比较简单的使用canvas的渲染逻辑，基本比较简单。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// resize canvas</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> data <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> rows<span class="token punctuation">,</span> cols <span class="token punctuation">}</span> <span class="token operator">=</span> data<span class="token punctuation">;</span>
    <span class="token comment">// fixed width of header 固定宽度</span>
    <span class="token keyword">const</span> fixedWidth <span class="token operator">=</span> cols<span class="token punctuation">.</span>indexWidth<span class="token punctuation">;</span>
    <span class="token comment">// fixed height of header 固定高度</span>
    <span class="token keyword">const</span> fiexedHeight <span class="token operator">=</span> rows<span class="token punctuation">.</span>height<span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>draw<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">viewWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> data<span class="token punctuation">.</span><span class="token function">viewHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> viewRange <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">viewRange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// renderAll.call(this, viewRange, data.scroll);</span>
    <span class="token keyword">const</span> tx <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">freezeTotalWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> ty <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">freezeTotalHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> x<span class="token punctuation">,</span> y <span class="token punctuation">}</span> <span class="token operator">=</span> data<span class="token punctuation">.</span>scroll<span class="token punctuation">;</span>
    <span class="token comment">// 1</span>
    <span class="token function">renderContentGrid</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> viewRange<span class="token punctuation">,</span> fixedWidth<span class="token punctuation">,</span> fiexedHeight<span class="token punctuation">,</span> tx<span class="token punctuation">,</span> ty<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">renderContent</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> viewRange<span class="token punctuation">,</span> fixedWidth<span class="token punctuation">,</span> fiexedHeight<span class="token punctuation">,</span> <span class="token operator">-</span>x<span class="token punctuation">,</span> <span class="token operator">-</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">renderFixedHeaders</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>
      <span class="token keyword">this</span><span class="token punctuation">,</span>
      <span class="token string">&quot;all&quot;</span><span class="token punctuation">,</span>
      viewRange<span class="token punctuation">,</span>
      fixedWidth<span class="token punctuation">,</span>
      fiexedHeight<span class="token punctuation">,</span>
      tx<span class="token punctuation">,</span>
      ty
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 渲染左侧栏</span>
    <span class="token function">renderFixedLeftTopCell</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> fixedWidth<span class="token punctuation">,</span> fiexedHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>fri<span class="token punctuation">,</span> fci<span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">.</span>freeze<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>fri <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">||</span> fci <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 2</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>fri <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> vr <span class="token operator">=</span> viewRange<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        vr<span class="token punctuation">.</span>sri <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        vr<span class="token punctuation">.</span>eri <span class="token operator">=</span> fri <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
        vr<span class="token punctuation">.</span>h <span class="token operator">=</span> ty<span class="token punctuation">;</span>
        <span class="token function">renderContentGrid</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> vr<span class="token punctuation">,</span> fixedWidth<span class="token punctuation">,</span> fiexedHeight<span class="token punctuation">,</span> tx<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">renderContent</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> vr<span class="token punctuation">,</span> fixedWidth<span class="token punctuation">,</span> fiexedHeight<span class="token punctuation">,</span> <span class="token operator">-</span>x<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">renderFixedHeaders</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>
          <span class="token keyword">this</span><span class="token punctuation">,</span>
          <span class="token string">&quot;top&quot;</span><span class="token punctuation">,</span>
          vr<span class="token punctuation">,</span>
          fixedWidth<span class="token punctuation">,</span>
          fiexedHeight<span class="token punctuation">,</span>
          tx<span class="token punctuation">,</span>
          <span class="token number">0</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// 3</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>fci <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> vr <span class="token operator">=</span> viewRange<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        vr<span class="token punctuation">.</span>sci <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        vr<span class="token punctuation">.</span>eci <span class="token operator">=</span> fci <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
        vr<span class="token punctuation">.</span>w <span class="token operator">=</span> tx<span class="token punctuation">;</span>
        <span class="token function">renderContentGrid</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> vr<span class="token punctuation">,</span> fixedWidth<span class="token punctuation">,</span> fiexedHeight<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> ty<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">renderFixedHeaders</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>
          <span class="token keyword">this</span><span class="token punctuation">,</span>
          <span class="token string">&quot;left&quot;</span><span class="token punctuation">,</span>
          vr<span class="token punctuation">,</span>
          fixedWidth<span class="token punctuation">,</span>
          fiexedHeight<span class="token punctuation">,</span>
          <span class="token number">0</span><span class="token punctuation">,</span>
          ty
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">renderContent</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> vr<span class="token punctuation">,</span> fixedWidth<span class="token punctuation">,</span> fiexedHeight<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// 4</span>
      <span class="token keyword">const</span> freezeViewRange <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">freezeViewRange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">renderContentGrid</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>
        <span class="token keyword">this</span><span class="token punctuation">,</span>
        freezeViewRange<span class="token punctuation">,</span>
        fixedWidth<span class="token punctuation">,</span>
        fiexedHeight<span class="token punctuation">,</span>
        <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token number">0</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">renderFixedHeaders</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>
        <span class="token keyword">this</span><span class="token punctuation">,</span>
        <span class="token string">&quot;all&quot;</span><span class="token punctuation">,</span>
        freezeViewRange<span class="token punctuation">,</span>
        fixedWidth<span class="token punctuation">,</span>
        fiexedHeight<span class="token punctuation">,</span>
        <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token number">0</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">renderContent</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> freezeViewRange<span class="token punctuation">,</span> fixedWidth<span class="token punctuation">,</span> fiexedHeight<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 5</span>
      <span class="token function">renderFreezeHighlightLine</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> fixedWidth<span class="token punctuation">,</span> fiexedHeight<span class="token punctuation">,</span> tx<span class="token punctuation">,</span> ty<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>到这里基本上使用x_spreadsheet('#x-spreadsheet-demo',options)的流程基本上就结束了。</p> <p>此时的ui图如下图所示：</p> <p>![image-20210710154508068](/Users/zsj/Library/Application Support/typora-user-images/image-20210710154508068.png)</p> <h3 id="loaddata"><a href="#loaddata" class="header-anchor">#</a> loadData</h3> <ol><li><p>当完成了初始的渲染之后，然后我们可以使用loadData来加载数据，来完成表格中加载数据的过程。</p> <p>可以先看下调用使用如下data，调用loadData达到的效果。</p></li></ol> <div class="language-js extra-class"><pre class="language-js"><code>     <span class="token keyword">const</span> rows <span class="token operator">=</span> <span class="token punctuation">{</span>
        len<span class="token operator">:</span> <span class="token number">80</span><span class="token punctuation">,</span>
        <span class="token number">1</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          cells<span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token number">0</span><span class="token operator">:</span> <span class="token punctuation">{</span> text<span class="token operator">:</span> <span class="token string">'testingtesttestetst'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token number">2</span><span class="token operator">:</span> <span class="token punctuation">{</span> text<span class="token operator">:</span> <span class="token string">'testing'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token number">2</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          cells<span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token comment">// 这里的style： 0 表示data中的styles的第一个元素</span>
            <span class="token number">0</span><span class="token operator">:</span> <span class="token punctuation">{</span> text<span class="token operator">:</span> <span class="token string">'render'</span><span class="token punctuation">,</span> style<span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token number">1</span><span class="token operator">:</span> <span class="token punctuation">{</span> text<span class="token operator">:</span> <span class="token string">'Hello'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token number">2</span><span class="token operator">:</span> <span class="token punctuation">{</span> text<span class="token operator">:</span> <span class="token string">'haha'</span><span class="token punctuation">,</span> merge<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token number">8</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          cells<span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token comment">// 这里的style： 0 表示data中的styles的第一个元素</span>
            <span class="token number">8</span><span class="token operator">:</span> <span class="token punctuation">{</span> text<span class="token operator">:</span> <span class="token string">'border test'</span><span class="token punctuation">,</span> style<span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> xs <span class="token operator">=</span> <span class="token function">x_spreadsheet</span><span class="token punctuation">(</span><span class="token string">'#x-spreadsheet-demo'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        showToolbar<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        showGrid<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        showBottomBar<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        col<span class="token operator">:</span> <span class="token punctuation">{</span>
          len<span class="token operator">:</span> <span class="token number">50</span><span class="token punctuation">,</span>
          width<span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
          <span class="token comment">// indexWidth: 60,</span>
          minWidth<span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        row<span class="token operator">:</span> <span class="token punctuation">{</span>
          len<span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        extendToolbar<span class="token operator">:</span> <span class="token punctuation">{</span>
          left<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
              tip<span class="token operator">:</span> <span class="token string">'Save'</span><span class="token punctuation">,</span>
              icon<span class="token operator">:</span> saveIcon<span class="token punctuation">,</span>
              <span class="token function-variable function">onClick</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span> sheet</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'click save button：'</span><span class="token punctuation">,</span> data<span class="token punctuation">,</span> sheet<span class="token punctuation">)</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">]</span><span class="token punctuation">,</span>
          right<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
              tip<span class="token operator">:</span> <span class="token string">'Preview'</span><span class="token punctuation">,</span>
              el<span class="token operator">:</span> previewEl<span class="token punctuation">,</span>
              <span class="token function-variable function">onClick</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span> sheet</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'click preview button：'</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">loadData</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">{</span>
          freeze<span class="token operator">:</span> <span class="token string">'B3'</span><span class="token punctuation">,</span>
          styles<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
              bgcolor<span class="token operator">:</span> <span class="token string">'#f4f5f8'</span><span class="token punctuation">,</span>
              textwrap<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
              color<span class="token operator">:</span> <span class="token string">'#900b09'</span><span class="token punctuation">,</span>
              border<span class="token operator">:</span> <span class="token punctuation">{</span>
                top<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'thin'</span><span class="token punctuation">,</span> <span class="token string">'#0366d6'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                bottom<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'thin'</span><span class="token punctuation">,</span> <span class="token string">'#0366d6'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                right<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'thin'</span><span class="token punctuation">,</span> <span class="token string">'#0366d6'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                left<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'thin'</span><span class="token punctuation">,</span> <span class="token string">'#0366d6'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">]</span><span class="token punctuation">,</span>
          merges<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token string">'C3:D4'</span><span class="token punctuation">,</span>
          <span class="token punctuation">]</span><span class="token punctuation">,</span>
          cols<span class="token operator">:</span> <span class="token punctuation">{</span>
            len<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
            <span class="token number">2</span><span class="token operator">:</span> <span class="token punctuation">{</span> width<span class="token operator">:</span> <span class="token number">200</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          rows<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>​	效果图如下</p> <p>![image-20210710155216048](/Users/zsj/Library/Application Support/typora-user-images/image-20210710155216048.png)</p> <ol start="2"><li>这里的关键是通过调用dataSheetProxy的resetData来重新渲染，然后调用到了table的resetData,然后table调用render来重新渲染。到此基本的渲染基本上就完成了。</li></ol> <h2 id="事件系统"><a href="#事件系统" class="header-anchor">#</a> 事件系统</h2> <h3 id="表格的点击事件"><a href="#表格的点击事件" class="header-anchor">#</a> 表格的点击事件</h3> <ol><li><p>通过createEventEmitter 注册事件， 文件目录(src/component/event.js)，这里的注册事件很简单，就是普通的发布订阅模式</p></li> <li><p>通过最外层的遮罩层监听事件函数，比如单击，比如双击，双击的时候，显示编辑框。</p></li></ol></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/blog/web/react/requestwork.html">
        requestwork
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/blog/assets/js/app.9b8d30b8.js" defer></script><script src="/blog/assets/js/2.0a93f5dd.js" defer></script><script src="/blog/assets/js/37.eaaf3327.js" defer></script>
  </body>
</html>
